<!--extentds-->
{% extends './common/base.html' %}

<!--title-->
{% block title %}详情页{% endblock %}

<!--sp_header-->
{% block sp_header %}
    <link rel="stylesheet" href="/stylesheet/detail.css">
{% endblock %}


<!--content-->
{% block content %}
<div id="index-banner" class="parallax-container">
    <div class="section no-pad-bot">
      <div class="container">
        <br><br>
        <h1 class="header center teal-text text-lighten-2"> {{room.addr_xiaoqu}}</h1>
        <div class="row center">
          <h5 class="header col s12 light"><span class="bigger">{{room.type_room}}</span>室<span class="bigger">{{room.type_livingroom}}</span>厅<span class="bigger">{{room.type_toilet}}</span>卫&nbsp;<span class="bigger">{{ room.price }}</span>/月&nbsp;{{ room.roomNumber }}</h5>
        </div>
        <div class="row center">
          <a href="#" id="download-button" data-target="yuyueanniu" class="btn-yuyue btn-large waves-effect waves-light teal lighten-1"><i class="large material-icons left">grade</i>收藏</a>
          <a href="#" id="download-button" class="btn-large waves-effect waves-light teal lighten-1"><i class="large material-icons left">contact_phone</i>预约</a>
        </div>
        <br><br>

      </div>
    </div>
    <div class="parallax">
        <img src="/resource/background1.jpg" alt="Unsplashed background img 2">





    </div>

</div>


  <div class="container">
    <div class="section">

      <!--   Icon Section   -->
      <div class="row">
        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center brown-text"><i class="mdi-image-flash-on"></i></h2>
            <h5 class="center">基本情况</h5>
            <div class="light">
                <div class="room-detail-content">
                    <div class="detail-item"><span class="detail-item-key">户型</span><span class="detail-item-value">{{ room.type_room}}室{{room.type_livingroom}}厅{{room.type_toilet}}卫</span></div>
                    <div class="detail-item"><span class="detail-item-key">租金</span><span class="detail-item-value">{{ room.price }}/月&nbsp;{{ room.payway }}</span></div>
                    <div class="detail-item"><span class="detail-item-key">面积</span><span class="detail-item-value">{{ room.mianji }}m2</span></div>
                    <div class="detail-item"><span class="detail-item-key">朝向</span><span class="detail-item-value">朝{{ room.orientation }}</span></div>
                    <div class="detail-item"><span class="detail-item-key">楼层</span><span class="detail-item-value">{{ room.floor_level}}/{{room.total_floor}}层</span></div>
                </div>
            </div>
          </div>
        </div>

        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center brown-text"><i class="mdi-social-group"></i></h2>
            <h5 class="center">房屋配置</h5>

            <div class="light">
                <div class="room-detail-content">
                    <div class="detail-item"><span class="detail-item-key">电梯</span><span class="detail-item-value">{% if room.elevator == "yes" %}有电梯{% else %}无电梯{% endif %}</span></div>
                    <div class="detail-item"><span class="detail-item-key">阳台</span><span class="detail-item-value">{% if room.balcony == "yes" %}有阳台{% else %}无阳台{% endif %}</span></div>
                    <div class="detail-item">
                        <span class="detail-item-key">屋内配置</span>
                        <span class="detail-item-value">
                            {% if room.canzhuo == "on" %}餐桌&nbsp{% endif %}
                            {% if room.sofa == "on" %}沙发&nbsp{% endif %}
                            {% if room.desk == "on" %}书桌&nbsp{% endif %}
                            {% if room.chair == "on" %}椅子&nbsp{% endif %}
                            {% if room.closet == "on" %}衣柜&nbsp{% endif %}
                            {% if room.bed == "on" %}床&nbsp{% endif %}
                            {% if room.aircon == "on" %}空调&nbsp{% endif %}
                            {% if room.washer == "on" %}洗衣机&nbsp{% endif %}
                            {% if room.waterheater == "on" %}热水器&nbsp{% endif %}
                            {% if room.refregister == "on" %}冰箱&nbsp{% endif %}
                            {% if room.tv == "on" %}电视机&nbsp{% endif %}
                            {% if room.cookerhood == "on" %}油烟机&nbsp{% endif %}
                            {% if room.gascooker == "on" %}燃气灶&nbsp{% endif %}
                        </span>
                    </div>
                </div>



            </div>
          </div>
        </div>

          <div class="col s12 m4">
              <div class="icon-block">
                <h2 class="center brown-text"><i class="mdi-image-flash-on"></i></h2>
                <h5 class="center">入住情况</h5>

                <div class="light">
                    <div class="room-detail-content">
                        <div class="detail-item"><span class="detail-item-key">入住时间</span><span class="detail-item-value">{{room.stay_intime|date:"Y-m-d"}}</span></div>
                        <div class="detail-item"><span class="detail-item-key">看房时间</span><span class="detail-item-value">{% if room.see == "on" %}随时可看{% else %}预约可看{% endif %}</span></div>
                    </div>

                    <div class="room-master">
                        <div class="room-master-img">

                        </div>

                        <div class="room-master-desc">
                            <div class="room-master-name">
                                联系人：</br>
                                {{contactPerson.name}}
                            </div>
                        </div>
                    </div>

                </div>
              </div>
            </div>
          </div>

    </div>
  </div>


  <div class="parallax-container valign-wrapper">
    <div class="section no-pad-bot">
      <div class="container">
        <div class="row center">
{#          <h5 class="header col s12 light">A modern responsive front-end framework based on Material Design</h5>#}
        </div>
      </div>
    </div>
    <div class="parallax">
        <img src="/resource/background3.jpg" alt="Unsplashed background img 2">

    </div>
  </div>

  <div class="container">
    <div class="section">

      <div class="row">
        <div class="col s6 center">
          <h3><i class="mdi-content-send brown-text"></i></h3>
          <h4>房源描述</h4>
          <div class="left-align light">
              <div class="room-detail-section">
                <div class="room-detail-content">
                    <div class="detail-item"><span class="detail-item-key">此房原户型</span><span class="detail-item-value"></span>
                    </div>
                    <div class="detail-item"><span class="detail-item-key">装修档次</span><span class="detail-item-value">{{room.decorate_level}}</span>
                    </div>
                    <div class="detail-item"><span class="detail-item-key">做饭情况</span><span class="detail-item-value">{{room.can_cook}}</span>
                    </div>
                    <div class="detail-item"><span class="detail-item-key">房屋优势</span><span class="detail-item-value">{{room.lighting}}</span>
                    </div>
                    <div class="detail-item"><span class="detail-item-key">房东要求</span><span class="detail-item-value">{{room.landlord_req}}</span>
                    </div>
                    <div class="detail-item"><span class="detail-item-key">其他描述</span><span class="detail-item-value">{{room.fit_people}}</span>
                    </div>

                </div>
            </div>
          </div>
        </div>

        <div class="col s6 center">
          <h3><i class="mdi-content-send brown-text"></i></h3>
          <h4>小区环境</h4>
          <div class="left-align light">
              <div class="room-detail-section">
                    <div class="room-detail-content">
                        <div class="detail-item"><span class="detail-item-key">所在商圈</span><span class="detail-item-value">西溪商圈西溪商圈西溪商圈</span>
                        </div>
                        <div class="detail-item"><span class="detail-item-key">小区属性</span><span class="detail-item-value">高档小区西溪商圈西溪商圈</span>
                        </div>
                        <div class="detail-item"><span class="detail-item-key">建造年代</span><span class="detail-item-value">3年西溪商圈西溪商圈</span>
                        </div>
                        <div class="detail-item"><span class="detail-item-key">小区档次规模</span><span class="detail-item-value">高档大规模小区西溪商圈西溪商圈西溪商圈</span>
                        </div>
                        <div class="detail-item"><span class="detail-item-key">安保</span><span class="detail-item-value">安全西溪商圈西溪商圈西溪商圈</span>
                        </div>
                    </div>
                </div>
          </div>
        </div>
      </div>

    </div>
  </div>


  <div class="parallax-container valign-wrapper">
    <div class="section no-pad-bot">
      <div class="container">
        <div class="row center">
{#          <h5 class="header col s12 light">A modern responsive front-end framework based on Material Design</h5>#}
        </div>
      </div>
    </div>
    <div class="parallax"><img src="/resource/background2.jpg" alt="Unsplashed background img 3"></div>
  </div>


    <div class="container">
    <div class="section">

      <div class="row">
        <div class="col s12 center">
            <div class="room-detail-section room-detail-section-fulllength">
                <div class="room-detail-title"><i class="material-icons">room</i>周边设施</div>
                <div class="room-detail-content peitao">
                    <a class="facility-item waves-effect waves-light btn" data-type="公交">公交</a>
                    <a class="facility-item waves-effect waves-light btn" data-type="地铁">地铁</a>
                    <a class="facility-item waves-effect waves-light btn" data-type="银行">银行</a>
                    <a class="facility-item waves-effect waves-light btn" data-type="医院">医院</a>
                    <a class="facility-item waves-effect waves-light btn" data-type="超市">超市</a>
                    <a class="facility-item waves-effect waves-light btn" data-type="餐馆">餐馆</a>
                    <div id="room-detail-map">

                    </div>
                </div>
            </div>


            <div class="room-detail-section room-detail-section-fulllength">
                <div class="room-detail-title"><i class="material-icons">visibility</i>房屋照片</div>
                <div class="room-detail-content">

                    <div class="row" style="position: relative;">

                         <div class="slider">
                            <ul class="slides">
                                {% for i in picture %}
                                    <li>
                                        <img src="{{ i.picture }}" height="500" width="auto">
                                    </li>
                                {% endfor %}

{#                              <li>#}
{#                                <img src="http://lorempixel.com/580/250/nature/2"> <!-- random image -->#}
{#                              </li>#}
{#                              <li>#}
{#                                <img src="http://lorempixel.com/580/250/nature/3">#}
{#                              </li>#}
{#                              <li>#}
{#                                <img src="http://lorempixel.com/580/250/nature/4">#}
{#                              </li>#}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="room-detail-section room-detail-section-fulllength" style="margin-top:0px">
                <div class="room-detail-title" style="margin-top:0px"><i class="material-icons">textsms</i>用户评价</div>
                <div class="room-detail-content">
                    {% for i in evaluation %}
                        <div class="row" style="position: relative;">s
                            <div class="comment-avatar" style="background: url(http://img.huoju365.com/file/5245a2fa-62f4-4ed1-af96-20cc167e56a8);-moz-background-size:100% 100%;background-size:100% 100%;"></div>
                            <div class="comment-content">
                                <span class="comment-quote">“</span>
                                {{ i.text }}
                            </div>
                        </div>
                    {% endfor %}

                    <div class="row" style="position: relative;margin-top:50px;margin-bottom:150px;">
                        <div class="comment-avatar" style="background: url(http://img.huoju365.com/file/5245a2fa-62f4-4ed1-af96-20cc167e56a8);-moz-background-size:100% 100%;background-size:100% 100%;"></div>
                        <div class="comment-content" style="border:none;padding:0;background: #f5f5f5;">
                            <form class="col s12">
                              <div class="row">
                                <div class="input-field col s12">
                                  <textarea id="textarea1" class="materialize-textarea"></textarea>
                                  <label for="textarea1">留下我的评论</label>
                                </div>
                              </div>
                            </form>
                            <button id="comment-submit" class="btn" style="position: absolute;bottom:-10px;left:10px;"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span>&nbsp;提交我的评论</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
      </div>

    </div>
  </div>


{% endblock %}

<!--sp_script-->
{% block sp_script %}

<script src="/js/jquery.pin.min.js" type="text/javascript"></script>
<script src="/js/stepcarousel.js" type="text/javascript"></script>
{#<script src="/js/carousel.js" type="text/javascript"></script>#}
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=gbADGzE7DryWx922MKlLKEnj"></script>
<script type="text/javascript">
    // 百度地图API功能

    //    地图创建
    var map = new BMap.Map("room-detail-map");    // 创建Map实例
    var mPoint = new BMap.Point({{ lng|safe }}, {{ lat|safe }});
//    map.enableScrollWheelZoom(false);
    map.centerAndZoom(mPoint,15);

    var circle = new BMap.Circle(mPoint,1000,{fillColor:"blue", strokeWeight: 1 ,fillOpacity: 0.2, strokeOpacity: 0.3});
    map.addOverlay(circle);
    var local =  new BMap.LocalSearch(map, {renderOptions: {map: map, autoViewport: false}});
    local.searchNearby('公交',mPoint,1000);

    //    添加控件
    var top_left_control = new BMap.ScaleControl({anchor: BMAP_ANCHOR_TOP_LEFT});// 左上角，添加比例尺
    var top_left_navigation = new BMap.NavigationControl();  //左上角，添加默认缩放平移控件
    map.addControl(top_left_control);
    map.addControl(top_left_navigation);

</script>

<script type="text/javascript">
{#    stepcarousel.setup({#}
{#        galleryid: 'mygallery', //id of carousel DIV#}
{#        beltclass: 'belt', //class of inner "belt" DIV containing all the panel DIVs#}
{#        panelclass: 'panel', //class of panel DIVs each holding content#}
{#        panelbehavior: {speed:300, wraparound:false, persist:true},#}
{#        autostep: {enable:true, moveby:4, pause:10000},#}
{#        defaultbuttons: {enable: true, moveby: 4, leftnav: ['/resource/butt-left.jpg', 0, 64], rightnav: ['/resource/butt-right.jpg', -11, 64]},#}
{#        statusvars: ['statusA', 'statusB', 'statusC'], //register 3 variables that contain current panel (start), current panel (last), and total panels#}
{#        contenttype: ['inline'], //content setting ['inline'] or ['external', 'path_to_external_file']#}
{#        oninit:function(){#}
{#            isloaded=true#}
{#            document.getElementById('displaycssbelt').style.visibility="visible";#}
{#//            document.getElementById('stocklevels').style.visibility="visible";#}
{#        }#}
{#    });#}


    $(document).ready(function(){
        $('.materialboxed').materialbox();
        $('.slider').slider();
    });
</script>

<script>
    $(function(){

        $('.button-collapse').sideNav();
        $('.parallax').parallax();


        //pin住右侧的房源情况
        $(".room-info").pin({
            containerSelector: "#pin-container"
        });

        //周边设施交互
        $(".facility-item ").bind("click",function(e){
{#            $(".facility-item.active").removeClass("active");#}
{#            $(this).addClass("active");#}

            var searchItem=$(this).data("type");
            local.searchNearby(searchItem,mPoint,1000);
        });

        $("#comment-submit").bind("click",function(e){
            var _text=$("#comment").val();
            var _num=$("#room-number").text();
            $.post(
                    {% url 'evaluation_add' %},
                    {
                        text:_text,
                        roomNumber:_num
                    },
                    function(data){
                        if(data.code==1){
                            console.log("post success");
                            alert("评论发布成功，正在等待管理员审核！");
                        }else{
                            console.log("post failed");
                            alert("评论发布失败！");
                        }
                    }
            )
            .error(function(){
                console.log("error");
            });
        });

        $(document).delegate(".btn-yuyue","click",function(e){
            e.preventDefault();
            var _id=$(this).data("target");
            var that=$(this);

            $.post(
                "{% url 'room_collection' %}",
                {roomNumber:_id},
                function(data){
                    if(data.status==200){
                        that.addClass("active");
                        console.log("post success");
                        alert("已加入收藏夹");
                    }else{
                        console.log("post failed");
                        if(msg){
                            alert(msg);
                        }
                    }
                }
            )
            .error(function(){
                console.log("error");
            });
        });
    });
</script>

{% endblock %}