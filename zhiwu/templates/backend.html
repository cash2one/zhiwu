<!--extentds-->
{% extends './common/baseForBack.html' %}

<!--title-->
{% block title %}后台管理{% endblock %}

<!--sp_header-->
{% block sp_header %}

{% endblock %}

<!--content-->
{% block content %}

<div class="container">
    <div class="row">
        <div class="col-xs-2" id="myScrollspy">
            <ul class="nav nav-pills nav-stacked" data-spy="affix" data-offset-top="70">

                <li>
                    <a href="#xiaoqu_manager">
                        小区库管理
                    </a>
                    <!--<ul class="second-level-menu">-->
                        <!--<li><a href="#xiaoqu_manager_add">小区新增</a></li>-->
                        <!--<li><a href="#xiaoqu_manager_search">小区查找</a></li>-->
                    <!--</ul>-->
                </li>

                <li>
                    <a href="#area_manager">
                        区域管理
                    </a>
                    <!--<ul class="second-level-menu">-->
                        <!--<li><a href="#area_manager_add">区域及账号建设</a></li>-->
                        <!--<li><a href="#area_manager_search">区域查找及修改</a></li>-->
                    <!--</ul>-->
                </li>

                <li>
                    <a href="#wuye_keeper_manager">
                        物业人员管理
                    </a>
                    <!--<ul class="second-level-menu">-->
                        <!--<li><a href="#wuye_keeper_manager_add">物业管家新增</a></li>-->
                        <!--<li><a href="#wuye_keeper_manager_search">物业管家查找</a></li>-->
                    <!--</ul>-->
                </li>



                <li>
                    <a href="#source_manager">
                        房源管理
                    </a>
                    <!--<ul class="second-level-menu">-->
                        <!--<li><a href="#source_manager_submit">房源发布</a></li>-->
                        <!--<li><a href="#source_manager_search">房源查找</a></li>-->
                    <!--</ul>-->
                </li>

                <!--<li>-->
                    <!--<a href="#data-statistics">-->
                        <!--数据统计-->
                    <!--</a>-->
                    <!--<ul class="second-level-menu">-->
                        <!--<li><a href="#">小区统计</a></li>-->
                        <!--<li><a href="#">区域统计</a></li>-->
                        <!--<li><a href="#">房源统计</a></li>-->
                        <!--<li><a href="#">客户流量</a></li>-->
                        <!--<li><a href="#">房源点击</a></li>-->
                        <!--<li><a href="#">停留时间</a></li>-->
                        <!--<li><a href="#">来电量</a></li>-->
                    <!--</ul>-->
                <!--</li>-->

                <li>
                    <a href="#mansion_manager_list">
                        公寓经理管理
                    </a>
                    <!--<ul class="second-level-menu">-->
                        <!--<li><a href="#mansion_manager_add">公寓经理新增</a></li>-->
                        <!--<li><a href="#mansion_manager_search">公寓经理查询</a></li>-->
                    <!--</ul>-->
                </li>


                <li>
                    <a href="#mansion_keeper_list">
                        公寓管家管理
                    </a>
                    <!--<ul class="second-level-menu">-->
                        <!--<li><a href="#mansion_keeper_add">公寓管家新增</a></li>-->
                        <!--<li><a href="#mansion_keeper_search">公寓管家查询</a></li>-->
                    <!--</ul>-->
                </li>

                <li>
                    <a href="#comment_list">
                        评论管理
                    </a>
                    <!--<ul class="second-level-menu">-->
                        <!--<li><a href="#mansion_keeper_add">公寓管家新增</a></li>-->
                        <!--<li><a href="#mansion_keeper_search">公寓管家查询</a></li>-->
                    <!--</ul>-->
                </li>



            </ul>
        </div>
        <div class="col-xs-offset-3 col-xs-9">
            <div class="section" id="xiaoqu_manager">
                <div class="title-l1">小区库管理</div>
                <div class="section-content">
                    <div class="section" id="xiaoqu_manager_add">
                        <div class="title-l2">小区新增</div>
                        <div class="section-content">
                            <form class="form-horizontal" id="xiaoqu_add_form" dest="{% url 'community_add' %}">
                                <div class="form-group">
                                    <label for="xiaoqu_add_name" class="col-sm-2 control-label">详细小区名称*</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="xiaoqu_add_name" name="xiaoqu_add_name">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="xiaoqu_add_manager" class="col-sm-2 control-label">小区管理负责人</label>
                                    <div class="col-sm-10">
                                        <select class="form-control" id="xiaoqu_add_manager" name="xiaoqu_add_manager">
                                            {% for i in managers %}
                                                <option value="{{ i.user }}">{{ i.user }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">详细位置点选*</label>
                                    <div class="col-sm-10">
                                        <div id="xiaoqu-map" style="width:100%;height:400px;margin-bottom:10px;"></div>
                                        <!--<button class="btn btn-success" id="save-point">保存当前位置</button>-->
                                        <input type="hidden" class="form-control" id="xiaoqu_add_lng" name="xiaoqu_add_lng" value="120.169848">
                                        <input type="hidden" class="form-control" id="xiaoqu_add_lat" name="xiaoqu_add_lat" value="30.276734">
                                    </div>
                                </div>
{#                                <div class="form-group">#}
{#                                    <label for="xiaoqu_add_area" class="col-sm-2 control-label">所属区域*</label>#}
{#                                    <div class="col-sm-10">#}
{#                                        <input type="text" class="form-control" id="xiaoqu_add_area" name="xiaoqu_add_area">#}
{#                                    </div>#}
{#                                </div>#}
{#                                <div class="form-group">#}
{#                                    <label for="xiaoqu_add_district" class="col-sm-2 control-label">所属行政区*</label>#}
{#                                    <div class="col-sm-10">#}
{#                                        <input type="text" class="form-control" id="xiaoqu_add_district" name="xiaoqu_add_district">#}
{#                                    </div>#}
{#                                </div>#}
                                <div class="form-group">
                                    <label for="xiaoqu_add_business" class="col-sm-2 control-label">所在商圈</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="xiaoqu_add_business" name="xiaoqu_add_business">
                                    </div>
                                </div>
{#                                <div class="form-group">#}
{#                                    <label for="xiaoqu_add_keyword" class="col-sm-2 control-label">其它关键字*</label>#}
{#                                    <div class="col-sm-10">#}
{#                                        <input type="text" class="form-control" id="xiaoqu_add_keyword" name="xiaoqu_add_keyword">#}
{#                                    </div>#}
{#                                </div>#}
                                <div class="form-group">
                                    <label for="xiaoqu_add_type" class="col-sm-2 control-label">小区属性</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="xiaoqu_add_type" name="xiaoqu_add_type" placeholder="普通住宅、公寓、商住、安置房等">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="xiaoqu_add_year" class="col-sm-2 control-label">建造年代</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="xiaoqu_add_year" name="xiaoqu_add_year">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="xiaoqu_add_level" class="col-sm-2 control-label">小区档次规模</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="xiaoqu_add_level" name="xiaoqu_add_level">
                                    </div>
                                </div>
{#                                <div class="form-group">#}
{#                                    <label for="xiaoqu_add_facility" class="col-sm-2 control-label">配套设施</label>#}
{#                                    <div class="col-sm-10">#}
{#                                        <input type="text" class="form-control" id="xiaoqu_add_facility" name="xiaoqu_add_facility">#}
{#                                    </div>#}
{#                                </div>#}
{#                                <div class="form-group">#}
{#                                    <label for="xiaoqu_add_green" class="col-sm-2 control-label">绿化</label>#}
{#                                    <div class="col-sm-10">#}
{#                                        <input type="text" class="form-control" id="xiaoqu_add_green" name="xiaoqu_add_green">#}
{#                                    </div>#}
{#                                </div>#}
                                <div class="form-group">
                                    <label for="xiaoqu_add_security" class="col-sm-2 control-label">安保</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="xiaoqu_add_security" name="xiaoqu_add_security" placeholder="有无门禁、治安状况">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="xiaoqu_add_keyword" class="col-sm-2 control-label">关键字</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="xiaoqu_add_keyword" name="xiaoqu_add_keyword" placeholder="">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <button class="btn btn-success btn-post">保存</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="section" id="xiaoqu_manager_search">
                        <div class="title-l2">小区查询</div>
                        <div class="section-content">
                            <form class="form-inline" id="xiaoqu_search_form" dest="{% url 'community_search' %}">
                                <div class="form-group">
                                    <label for="xiaoqu_search_name" class="control-label">小区名称*</label>
                                    <input type="text" class="form-control" id="xiaoqu_search_name" name="xiaoqu_search_name">
                                </div>

                                <div class="form-group">
                                    <button class="btn btn-info btn-get" data-type="xiaoqu">搜索</button>
                                </div>
                            </form>



                            <table class="table table-striped" data-tmpl="#xiaoqu-edit">
                                <thead>
                                <tr>
                                    <th>详细小区名称</th>
                                    <th>所在商圈</th>
                                    <th>其它关键字</th>
                                    <th>房屋类型</th>
                                    <th>建成年限</th>
                                    <th>小区档次</th>
                                    <th>安保</th>
                                </tr>
                                </thead>
                                <tbody id="xiaoqu-search-result">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="area_manager">
                <div class="title-l1">区域管理</div>
                <div class="section-content">
                    <div class="section" id="area_name_add">
                        <div class="title-l2">区域名新建</div>
                        <div class="section-content">
                            <form class="form-horizontal" id="area_name_add_form" dest="{% url 'post_new_area' %}">
                                <div class="form-group">
                                    <label for="area_add_name" class="col-sm-2 control-label">区域名</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="area_add_mame" name="name">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <button class="btn btn-success btn-post">保存</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="section" id="area_name_search">
                        <div class="title-l2">区域名查询</div>
                        <div class="section-content">
                            <form class="form-inline" id="area_name_search_form" dest="{% url 'get_area_name' %}">
                                <div class="form-group">
                                    <label for="area_search_name" class="control-label">区域名</label>
                                    <input type="text" class="form-control" id="area_name_search_name" name="name">
                                </div>

                                <div class="form-group">
                                    <button class="btn btn-info btn-get" data-type="areaname">搜索</button>
                                </div>
                            </form>


                            <table class="table table-striped" data-tmpl="areaname">
                                <thead>
                                <tr>
                                    <th>区名称</th>
                                </tr>
                                </thead>
                                <tbody id="areaname-search-result">

                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="section" id="area_manager_add">
                        <div class="title-l2">区域及账号建设</div>
                        <div class="section-content">
                            <form class="form-horizontal" id="area_add_form" dest="{% url 'area_add' %}">
                                <div class="form-group">
                                    <label for="area_add_account" class="col-sm-2 control-label">区账号</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="area_add_account" name="manager_account">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="area_add_pw" class="col-sm-2 control-label">密码</label>
                                    <div class="col-sm-10">
                                        <input type="password" class="form-control">
                                        <input type="hidden" class="form-control" id="area_add_pw" name="manager_pw">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="area_add_name" class="col-sm-2 control-label">区域名</label>
                                    <div class="col-sm-10">
                                        <select class="form-control" id="area_add_name" name="manager_district">
                                            {% for i in area_list %}
                                                <option value="{{ i.name }}">{{ i.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="area_add_manager_name" class="col-sm-2 control-label">区经理姓名</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="area_add_manager_name" name="manager_name">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="area_add_phone" class="col-sm-2 control-label">区域手机</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="area_add_phone" name="manager_phone">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <button class="btn btn-success btn-post">保存</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="section" id="area_manager_search">
                        <div class="title-l2">区域查找及修改</div>
                        <div class="section-content">
                            <form class="form-inline" id="area_search_form" dest="{% url 'area_search' %}">
                                <div class="form-group">
                                    <label for="area_search_name" class="control-label">区域名称*</label>
                                    <input type="text" class="form-control" id="area_search_name" name="manager_search_district">
                                </div>

                                <div class="form-group">
                                    <button class="btn btn-info btn-get" data-type="area">搜索</button>
                                </div>
                            </form>


                            <table class="table table-striped" data-tmpl="#area-edit">
                                <thead>
                                <tr>
                                    <th>区账号</th>
                                    <th>区域名</th>
                                    <th>区经理姓名</th>
                                    <th>区域手机</th>
                                    <th>状态</th>
                                </tr>
                                </thead>
                                <tbody id="area-search-result">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="wuye_keeper_manager">
                <div class="title-l1">物业人员管理</div>
                <div class="section-content">
                    <div class="section" id="wuye_keeper_manager_add">
                        <div class="title-l2">物业管家新增</div>
                        <div class="section-content">
                            <form class="form-horizontal" id="wuye_keeper_add_form" dest="{% url 'wuye_add' %}">
                                <div class="form-group">
                                    <label for="wuye_keeper_add_account" class="col-sm-2 control-label">账号</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="wuye_keeper_add_account" name="second_manager_account">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="wuye_keeper_add_pw" class="col-sm-2 control-label">密码</label>
                                    <div class="col-sm-10">
                                        <input type="password" class="form-control">
                                        <input type="hidden" class="form-control" id="wuye_keeper_add_pw" name="second_manager_pw">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="wuye_keeper_add_manager" class="col-sm-2 control-label">所属区域管理员</label>
                                    <div class="col-sm-10">
                                        <select class="form-control select-listener" id="wuye_keeper_add_manager" name="second_manager_manager">
                                                                                        <option value="">请选择管理员</option>

                                            {% for i in managers %}
                                                {% if i.status == 'area' %}
                                                    <option value="{{ i.user }}">{{ i.user }}</option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="wuye_keeper_add_xiaoqu" class="col-sm-2 control-label">所属小区</label>
                                    <div class="col-sm-10">
                                        <select class="form-control" id="wuye_keeper_add_xiaoqu" name="second_manager_company">
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="wuye_keeper_add_name" class="col-sm-2 control-label">管家姓名</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="wuye_keeper_add_name" name="second_manager_name">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="wuye_keeper_add_phone" class="col-sm-2 control-label">管家手机</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="wuye_keeper_add_phone" name="second_manager_phone">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <button class="btn btn-success btn-post">保存</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="section" id="wuye_keeper_manager_search">
                        <div class="title-l2">物业管家查找</div>
                        <div class="section-content">
                            <form class="form-inline" id="wuye_keeper_search_form" dest="{% url 'wuye_search' %}">
                                <div class="form-group">
                                    <label for="wuye_keeper_search_account" class="control-label">小区</label>
                                    <input type="text" class="form-control" id="wuye_keeper_search_account" name="second_manager_search_company">
                                </div>

                                <div class="form-group">
                                    <button class="btn btn-info btn-get" data-type="wuye-keeper">搜索</button>
                                </div>
                            </form>


                            <table class="table table-striped" data-tmpl="#wuye-keeper-edit">
                                <thead>
                                <tr>
                                    <th>账号</th>
                                    <th>所属区域管理员</th>
                                    <th>所属小区</th>
                                    <th>管家姓名</th>
                                    <th>管家手机</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody id="wuye-keeper-search-result">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="source_manager">
                <div class="title-l1">房源管理</div>
                <div class="section-content">
{#                    <div class="section" id="source-manager-new">#}
{#                        <div class="title-l2">发布房源</div>#}
{#                        <a class="btn btn-success" href="{% url 'new_house' %}" target="_blank">租房房源</a>#}
{#                        <a class="btn btn-success" href="{% url 'new_salehouse' %}" target="_blank">卖房房源</a>#}
{#                    </div>#}
                    <div class="section" id="source-manager-export">
                        <div class="title-l2">房源导出</div>
                        <div class="section-content">
                            <a class="btn btn-info btn-export" href="{% url 'download_roominfo' %}" target="_blank">导出为租房excel文件</a>
                            <a class="btn btn-info btn-export" href="{% url 'download_salehouse' %}" target="_blank">导出为卖房excel文件</a>
                        </div>
                    </div>
                    <div class="section" id="source-manager-sale-search">
                        <div class="title-l2">卖房房源搜索</div>
                        <div class="section-content">
                            <form class="form-inline" id="house_search_form" dest="/salehouse_search">
                                <div class="form-group" style="margin-right:30px;">
                                    <label class="control-label">类型：</label>
                                    <label for="no" class="checkbox-inline">
                                        <input type="radio" name="house_status" id="no" checked value="no"/>
                                        不限
                                    </label>
                                    <label for="salehouse_activated" class="checkbox-inline">
                                        <input type="radio" name="house_status" id="salehouse_activated" value="active"/>
                                        已上架
                                    </label>
                                    <label for="salehouse_canceled" class="checkbox-inline">
                                        <input type="radio" name="house_status" id="salehouse_canceled" value="cancel"/>
                                        已下架
                                    </label>
                                </div>

                                <div class="form-group">
                                    <label for="salehouse_area" class="control-label">区域：</label>
                                    <select class="form-control" id="salehouse_area" name="house_area">
                                        <option value="no">不限</option>
                                        {% for i in area_list %}
                                            <option value="{{ i.name }}">{{ i.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <input type="hidden" name="p" value="1"/>
                                <div class="form-group">
                                    <button class="btn btn-info btn-get" data-type="salehouse">搜索</button>
                                </div>
                            </form>

                            <input type="hidden" id="cache_salehouse_area">
                            <input type="hidden" id="cache_salehouse_status">

                            <table class="table table-striped" data-tmpl="salehouse" id="salehouse-table">
                                <thead>
                                <tr>
                                    <th>房源编号</th>
                                    <th>发布时间</th>
                                    <th>小区</th>
                                    <th>户型</th>
                                    <th>价格</th>
                                    <th>鉴定员/发布员</th>
                                    <th>经纪人/管家</th>
                                    <th>有无照片</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody id="salehouse-search-result">

                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="section" id="source-manager-rent-search">
                        <div class="title-l2">租房房源搜索</div>
                        <div class="section-content">
                            <form class="form-inline" id="house_search_form" dest="/room_search">
                                <div class="form-group" style="margin-right:30px;">
                                    <label class="control-label">类型：</label>
                                    <label for="no" class="checkbox-inline">
                                        <input type="radio" name="house_status" id="no" checked value="no"/>
                                        不限
                                    </label>
                                    <label for="house_activated" class="checkbox-inline">
                                        <input type="radio" name="house_status" id="house_activated" value="active"/>
                                        已上架
                                    </label>
                                    <label for="house_canceled" class="checkbox-inline">
                                        <input type="radio" name="house_status" id="house_canceled" value="cancel"/>
                                        已下架
                                    </label>
                                </div>

                                <div class="form-group">
                                    <label for="house_area" class="control-label">区域：</label>
                                    <select class="form-control" id="house_area" name="house_area">
                                        <option value="no">不限</option>
                                        {% for i in area_list %}
                                            <option value="{{ i.name }}">{{ i.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="form-group">
                                    <button class="btn btn-info btn-get" data-type="house">搜索</button>
                                </div>
                            </form>

                            <input type="hidden" id="cache_house_area">
                            <input type="hidden" id="cache_house_status">

                            <table class="table table-striped" data-tmpl="house" id="house-table">
                                <thead>
                                <tr>
                                    <th>房源编号</th>
                                    <th>发布时间</th>
                                    <th>小区</th>
                                    <th>户型</th>
                                    <th>价格</th>
                                    <th>入住时间</th>
                                    <th>鉴定员/发布员</th>
                                    <th>经纪人/管家</th>
                                    <th>有无照片</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody id="house-search-result">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!--<div class="section" id="data-statistics">-->
                <!--<div class="title-l1">数据统计</div>-->
                <!--<div class="section-content">-->
                    <!--<div class="section">-->
                        <!--<div class="title-l2">小区统计</div>-->
                        <!--<div class="section-content">-->

                        <!--</div>-->
                    <!--</div>-->

                    <!--<div class="section">-->
                        <!--<div class="title-l2">区域统计</div>-->
                        <!--<div class="section-content">-->

                        <!--</div>-->
                    <!--</div>-->

                    <!--<div class="section">-->
                        <!--<div class="title-l2">房源统计</div>-->
                        <!--<div class="section-content">-->

                        <!--</div>-->
                    <!--</div>-->

                    <!--<div class="section">-->
                        <!--<div class="title-l2">客户流量</div>-->
                        <!--<div class="section-content">-->

                        <!--</div>-->
                    <!--</div>-->

                    <!--<div class="section">-->
                        <!--<div class="title-l2">房源点击</div>-->
                        <!--<div class="section-content">-->

                        <!--</div>-->
                    <!--</div>-->

                    <!--<div class="section">-->
                        <!--<div class="title-l2">停留时间</div>-->
                        <!--<div class="section-content">-->

                        <!--</div>-->
                    <!--</div>-->

                    <!--<div class="section">-->
                        <!--<div class="title-l2">来电量</div>-->
                        <!--<div class="section-content">-->

                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->

            <div class="section" id="mansion_manager_list">
                <div class="title-l1">公寓经理管理</div>
                <div class="section-content">
                    <div class="section" id="mansion_manager_add">
                        <div class="title-l2">公寓经理新增</div>
                        <div class="section-content">
                            <form class="form-horizontal" id="mansion_manager_add_form" dest="{% url 'mansion_add' %}">
                                <div class="form-group">
                                    <label for="mansion_manager_add_account" class="col-sm-2 control-label">账号*</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="mansion_manager_add_account" name="manager_account">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="mansion_manager_add_pw" class="col-sm-2 control-label">密码</label>
                                    <div class="col-sm-10">
                                        <input type="password" class="form-control">
                                        <input type="hidden" class="form-control" id="mansion_manager_add_pw" name="manager_pw">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="mansion_manager_add_district" class="col-sm-2 control-label">公司</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="mansion_manager_add_district" name="manager_district">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="mansion_manager_add_name" class="col-sm-2 control-label">姓名</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="mansion_manager_add_name" name="manager_name">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="mansion_manager_add_phone" class="col-sm-2 control-label">手机</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="mansion_manager_add_phone" name="manager_phone">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <button class="btn btn-success btn-post">保存</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="section" id="mansion_manager_search">
                        <div class="title-l2">公寓经理查找</div>
                        <div class="section-content">
                            <form class="form-inline" id="mansion_manager_search_form" dest="{% url 'mansion_manager_search' %}">
                                <div class="form-group">
                                    <label for="mansion_manager_search_account" class="control-label">公司</label>
                                    <input type="text" class="form-control" id="mansion_manager_search_account" name="manager_search_district">
                                </div>

                                <div class="form-group">
                                    <button class="btn btn-info btn-get" data-type="mansion-manager">搜索</button>
                                </div>
                            </form>


                            <table class="table table-striped" data-tmpl="#mansion-manager-edit">
                                <thead>
                                <tr>
                                    <th>账号</th>
                                    <th>公司</th>
                                    <th>姓名</th>
                                    <th>手机</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody id="mansion-manager-search-result">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="mansion_keeper_list">
                <div class="title-l1">公寓管家管理</div>
                <div class="section-content">
                    <div class="section" id="mansion_keeper_add">
                        <div class="title-l2">公寓管家新增</div>
                        <div class="section-content">
                            <form class="form-horizontal" id="masion_keeper_add_form" dest="{% url 'mansion_keeper_add' %}">
                                <div class="form-group">
                                    <label for="masion_keeper_add_account" class="col-sm-2 control-label">账号</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="masion_keeper_add_account" name="second_manager_account">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="masion_keeper_add_pw" class="col-sm-2 control-label">密码</label>
                                    <div class="col-sm-10">
                                        <input type="password" class="form-control">
                                        <input type="hidden" class="form-control" id="masion_keeper_add_pw" name="second_manager_pw">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="masion_keeper_add_xiaoqu" class="col-sm-2 control-label">所属业务经理</label>
                                    <div class="col-sm-10">
                                        <select class="form-control" id="masion_keeper_add_xiaoqu" name="second_manager_manager">
                                            {% for i in managers %}
                                                {% if i.status == 'mansion' %}
                                                    <option value="{{ i.user }}">{{ i.user }}</option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="masion_keeper_add_company" class="col-sm-2 control-label">所属公司</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="masion_keeper_add_company" name="second_manager_company">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="masion_keeper_add_name" class="col-sm-2 control-label">管家姓名</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="masion_keeper_add_name" name="second_manager_name">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="masion_keeper_add_phone" class="col-sm-2 control-label">管家手机</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="masion_keeper_add_phone" name="second_manager_phone">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <button class="btn btn-success btn-post">保存</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="section" id="mansion_keeper_search">
                        <div class="title-l2">公寓管家查询</div>
                        <div class="section-content">
                            <form class="form-inline" id="masion_keeper_search_form" dest="{% url 'mansion_keeper_search' %}">
                                <div class="form-group">
                                    <label for="masion_keeper_search_account" class="control-label">公司*</label>
                                    <input type="text" class="form-control" id="masion_keeper_search_account" name="second_manager_search_company">
                                </div>

                                <div class="form-group">
                                    <button class="btn btn-info btn-get" data-type="mansion-keeper">搜索</button>
                                </div>
                            </form>


                            <table class="table table-striped" data-tmpl="#mansion-keeper-edit">
                                <thead>
                                <tr>
                                    <th>账号</th>
                                    <th>所属业务经理</th>
                                    <th>所属公司</th>
                                    <th>管家姓名</th>
                                    <th>管家手机</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody id="mansion-keeper-search-result">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="comment_list">
                <div class="title-l1">评论审核</div>
                <div class="section-content">
                    <table class="table table-striped" data-tmpl="comment">
                        <thead>
                        <tr>
                            <th>房源</th>
                            <th>评论内容</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="comment-result">


                        </tbody>
                    </table>
                    <div id="Pagination" class="pagination"><!-- 这里显示分页 --></div>

                </div>
            </div>

        </div>
        </div>
    </div>
</div>


<div id="xiaoqu-edit-dialog" style="display: none;">
    <form class="form-horizontal" id="xiaoqu_add_form" dest="/community_add/">
        <div class="form-group">
            <label class="col-sm-2 control-label">详细位置点选*</label>
            <div class="col-sm-10">
                <div id="edit-xiaoqu-map" style="width:100%;height:400px;margin-bottom:10px;"></div>
            </div>
        </div>

        <div id="xiaoqu-edit-wrapper"></div>
    </form>
</div>

{% endblock %}

<!--sp_script-->
{% block sp_script %}


{% verbatim %}
<script id="xiaoqu-edit" type="text/x-jquery-tmpl">

                                <div class="form-group">
                                    <label for="xiaoqu_add_name" class="col-sm-2 control-label">详细小区名称*</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="xiaoqu_add_name" name="xiaoqu_add_name" value="${name}">
                                    </div>
                                </div>
                                 <div class="form-group">
                                    <label for="xiaoqu_add_manager" class="col-sm-2 control-label">小区管理负责人</label>
                                    <div class="col-sm-10">
                                        <select class="form-control" id="xiaoqu_add_manager" name="xiaoqu_add_manager">
                                            {{each manager_list}}
                                                <option value="${$value}" {{if $value == manager}}selected{{/if}}>${$value}</option>
                                            {{/each}}
                                        </select>
                                    </div>
                                </div>

                                <input type="hidden" class="form-control" id="edit_xiaoqu_add_lng" name="xiaoqu_add_lng" value="${lng}">
                                <input type="hidden" class="form-control" id="edit_xiaoqu_add_lat" name="xiaoqu_add_lat" value="${lat}">

                                <div class="form-group">
                                    <label for="xiaoqu_add_business" class="col-sm-2 control-label">所在商圈</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="xiaoqu_add_business" name="xiaoqu_add_business" value="${business}">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="xiaoqu_add_type" class="col-sm-2 control-label">房屋类型*</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="xiaoqu_add_type" name="xiaoqu_add_type" value="${type}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="xiaoqu_add_year" class="col-sm-2 control-label">建造年代*</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="xiaoqu_add_year" name="xiaoqu_add_year" value="${year}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="xiaoqu_add_level" class="col-sm-2 control-label">小区档次规模</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="xiaoqu_add_level" name="xiaoqu_add_level" value="${level}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="xiaoqu_add_security" class="col-sm-2 control-label">安保</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="xiaoqu_add_security" name="xiaoqu_add_security" value="${security}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="xiaoqu_add_keyword" class="col-sm-2 control-label">关键字*</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="xiaoqu_add_keyword" name="xiaoqu_add_keyword" value="${keyword}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <button class="btn btn-success btn-post">保存</button>
                                    </div>
                                </div>
</script>

<script id="area-edit" type="text/x-jquery-tmpl">
 <form class="form-horizontal" id="area_add_form" dest="/area_modify/">
                                <div class="form-group">
                                    <label for="area_add_account" class="col-sm-2 control-label">区账号</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="area_add_account" name="manager_account" value="${user}" disabled>
                                        <input type="hidden" name="manager_account" value="${user}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="area_add_pw" class="col-sm-2 control-label">密码</label>
                                    <div class="col-sm-10">
                                        <input type="password" class="form-control">
                                        <input type="hidden" class="form-control" id="area_add_pw" name="manager_pw">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="area_add_name" class="col-sm-2 control-label">区域名</label>
                                    <div class="col-sm-10">

                                        <select class="form-control select-listener" id="area_add_name" name="manager_district">
                                            {{each area_list}}
                                                <option value="${$value}" {{if $value == district}}selected{{/if}}>${$value}</option>
                                            {{/each}}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="area_add_manager_name" class="col-sm-2 control-label">区经理姓名</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="area_add_manager_name" name="manager_name" value=${name}>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="area_add_phone" class="col-sm-2 control-label">区域手机</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="area_add_phone" name="manager_phone" value="${phone}">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <button class="btn btn-success btn-post">保存</button>
                                    </div>
                                </div>
                            </form>
</script>

<script id="wuye-keeper-edit" type="text/x-jquery-tmpl">
 <form class="form-horizontal" id="wuye_keeper_add_form" dest="/wuye_modify/">
                                <div class="form-group">
                                    <label for="wuye_keeper_add_account" class="col-sm-2 control-label">账号</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="wuye_keeper_add_account" name="second_manager_account" value="${user}" disabled>
                                        <input type="hidden" name="second_manager_account" value="${user}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="wuye_keeper_add_pw" class="col-sm-2 control-label">密码</label>
                                    <div class="col-sm-10">
                                        <input type="password" class="form-control">
                                        <input type="hidden" class="form-control" id="wuye_keeper_add_pw" name="second_manager_pw">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="wuye_keeper_add_manager" class="col-sm-2 control-label">所属区域管理员</label>
                                    <div class="col-sm-10">
                                        <select class="form-control select-listener" id="edit_wuye_keeper_add_manager" name="second_manager_manager">
                                            {{each m_list}}
                                                {{if $value.status == "area" }}
                                                    <option value="${$value.pk}" {{if $value.pk == manager}}selected{{/if}}>${$value.pk}</option>
                                                {{/if}}
                                            {{/each}}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="wuye_keeper_add_xiaoqu" class="col-sm-2 control-label">所属小区</label>
                                    <div class="col-sm-10">
                                        <select class="form-control" id="edit_wuye_keeper_add_xiaoqu" name="second_manager_company">
                                            {{each community_list}}
                                                <option value="${$value}" {{if $value == company}}selected{{/if}}>${$value}</option>
                                            {{/each}}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="wuye_keeper_add_name" class="col-sm-2 control-label">管家姓名</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="wuye_keeper_add_name" name="second_manager_name" value="${name}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="wuye_keeper_add_phone" class="col-sm-2 control-label">管家手机</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="wuye_keeper_add_phone" name="second_manager_phone" value="${phone}">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <button class="btn btn-success btn-post">保存</button>
                                    </div>
                                </div>
                            </form>
</script>

<script id="mansion-keeper-edit" type="text/x-jquery-tmpl">
<form class="form-horizontal" id="masion_keeper_add_form" dest="/mansion_keeper_modify/">
                                <div class="form-group">
                                    <label for="masion_keeper_add_account" class="col-sm-2 control-label">账号</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="masion_keeper_add_account" name="second_manager_account" value="${user}" disabled>
                                        <input type="hidden" name="second_manager_account" value="${user}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="masion_keeper_add_pw" class="col-sm-2 control-label">密码</label>
                                    <div class="col-sm-10">
                                        <input type="password" class="form-control">
                                        <input type="hidden" class="form-control" id="masion_keeper_add_pw" name="second_manager_pw">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="masion_keeper_add_xiaoqu" class="col-sm-2 control-label">所属业务经理</label>
                                    <div class="col-sm-10">
                                        <select class="form-control" id="edit_masion_keeper_add_xiaoqu" name="second_manager_manager">
                                            {{each m_list}}
                                                {{if $value.status == "mansion" }}
                                                    <option value="${$value.pk}" {{if $value.pk == manager}}selected{{/if}}>${$value.pk}</option>
                                                {{/if}}
                                            {{/each}}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="masion_keeper_add_company" class="col-sm-2 control-label">所属公司</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="masion_keeper_add_company" name="second_manager_company" value="${company}">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="masion_keeper_add_name" class="col-sm-2 control-label">管家姓名</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="masion_keeper_add_name" name="second_manager_name" value="${name}">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="masion_keeper_add_phone" class="col-sm-2 control-label">管家手机</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="masion_keeper_add_phone" name="second_manager_phone" value="${phone}">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <button class="btn btn-success btn-post">保存</button>
                                    </div>
                                </div>
                            </form>
</script>

<script id="mansion-manager-edit" type="text/x-jquery-tmpl">
<form class="form-horizontal" id="mansion_manager_add_form" dest="/mansion_manager_modify/">
                                <div class="form-group">
                                    <label for="mansion_manager_add_account" class="col-sm-2 control-label">账号*</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="mansion_manager_add_account" name="manager_account" value="${user}" disabled>
                                        <input type="hidden" value="${user}" name="manager_account"/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="mansion_manager_add_pw" class="col-sm-2 control-label">密码</label>
                                    <div class="col-sm-10">
                                        <input type="password" class="form-control">
                                        <input type="hidden" class="form-control" id="mansion_manager_add_pw" name="manager_pw">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="mansion_manager_add_district" class="col-sm-2 control-label">公司</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="mansion_manager_add_district" name="manager_district" value="${district}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="mansion_manager_add_name" class="col-sm-2 control-label">姓名</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="mansion_manager_add_name" name="manager_name" value="${name}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="mansion_manager_add_phone" class="col-sm-2 control-label">手机</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="mansion_manager_add_phone" name="manager_phone" value="${phone}">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <button class="btn btn-success btn-post">保存</button>
                                    </div>
                                </div>
                            </form>
</script>


<script id="xiaoqu-search" type="text/x-jquery-tmpl">
<tr data-target="${pk}">
                                    <th>${pk}</th>
                                    <th>${fields.business}</th>
                                    <th>${fields.keyword}</th>
                                    <th>${fields.type}</th>
                                    <th>${fields.year}</th>
                                    <th>${fields.level}</th>
                                    <th>${fields.security}</th>
                                    <th class="btn-group">
                                        <button class="btn btn-default dropdown-toggle" data-toggle="dropdown">操作<span class="caret"></span></button>
                                        <ul class="dropdown-menu">
                                            <li><a href="#" class="btn-edit">编辑</a></li>
                                            <li><a href="#" class="btn-operate" data-type="cancel">删除</a></li>
                                        </ul>
                                    </th>
                                </tr>

</script>

<script id="area-search" type="text/x-jquery-tmpl">
<tr data-target="${pk}">
                                    <th>${pk}</th>
                                    <th>${fields.district}</th>
                                    <th>${fields.name}</th>
                                    <th>${fields.phone}</th>
                                    <th>{{if fields.exist}}正在使用{{else}}已注销{{/if}}</th>
                                    <th>
                                        <button class="btn btn-default btn-edit">编辑</button>
                                        <button class="btn btn-danger btn-operate" data-type="cancel">注销</button>
                                        <button class="btn btn-success btn-operate" data-type="activate">激活</button>
                                    </th>
                                </tr>

</script>

<script id="wuye-keeper-search" type="text/x-jquery-tmpl">
<tr data-target="${pk}">
                                    <th>${pk}</th>
                                    <th>${fields.manager}</th>
                                    <th>${fields.company}</th>
                                    <th>${fields.name}</th>
                                    <th>${fields.phone}</th>
                                    <th>{{if fields.exist}}正在使用{{else}}已注销{{/if}}</th>
                                    <th>
                                        <button class="btn btn-default btn-edit">编辑</button>
                                        <button class="btn btn-danger btn-operate" data-type="cancel">注销</button>
                                        <button class="btn btn-success btn-operate" data-type="activate">激活</button>
                                    </th>
                                </tr>

</script>

<script id="mansion-manager-search" type="text/x-jquery-tmpl">
<tr data-target="${pk}">
                                    <th>${pk}</th>
                                    <th>${fields.district}</th>
                                    <th>${fields.name}</th>
                                    <th>${fields.phone}</th>
                                    <th>{{if fields.exist}}正在使用{{else}}已注销{{/if}}</th>
                                    <th>
                                        <button class="btn btn-default btn-edit">编辑</button>
                                        <button class="btn btn-danger btn-operate" data-type="cancel">注销</button>
                                        <button class="btn btn-success btn-operate" data-type="activate">激活</button>
                                    </th>
                                </tr>

</script>

<script id="mansion-keeper-search" type="text/x-jquery-tmpl">
<tr data-target="${pk}">
                                    <th>${pk}</th>
                                    <th>${fields.manager}</th>
                                    <th>${fields.company}</th>
                                    <th>${fields.name}</th>
                                    <th>${fields.phone}</th>
                                    <th>{{if fields.exist}}正在使用{{else}}已注销{{/if}}</th>
                                    <th>
                                        <button class="btn btn-default btn-edit">编辑</button>
                                        <button class="btn btn-danger btn-operate" data-type="cancel">注销</button>
                                        <button class="btn btn-success btn-operate" data-type="activate">激活</button>
                                    </th>
                                </tr>
</script>


<script id="house-search" type="text/x-jquery-tmpl">

<tr data-target="${pk}">
                                        <th>${pk}</th>
                                        <th>${fields.create_time}</th>
                                        <th>${fields.addr_xiaoqu}</th>
                                        <th>${fields.type_room}室${fields.type_livingroom}厅${fields.type_toilet}卫</th>
                                        <th>${fields.price}/月</th>
                                        <th>${fields.stay_intime}</th>
                                        <th>${fields.contactPerson}</th>
                                        <th>${fields.contactPerson}</th>
                                        <th>{{if fields.have_image}}有{{else}}无{{/if}}</th>
                                        <th>
                                            {{if fields.sold}}
                                                已下架
                                            {{else fields.exist}}
                                                已上架
                                            {{else}}
                                                待编辑
                                            {{/if}}
                                        </th>
                                        <th class="btn-group">
                                            <button class="btn btn-default dropdown-toggle" data-toggle="dropdown">操作<span class="caret"></span></button>
                                            <ul class="dropdown-menu">
                                                {{if fields.sold }}

                                                {{else fields.exist}}
                                                    <li><a href="#" class="btn-operate" data-type="sold">下架</a></li>
                                                    <li><a href="/new_house/?roomNumber=${pk}">编辑</a></li>
                                                {{else}}
                                                    <li><a href="/new_house/?roomNumber=${pk}">编辑</a></li>
                                                {{/if}}
                                            </ul>
                                        </th>
                                    </tr>

</script>


<script id="salehouse-search" type="text/x-jquery-tmpl">
<tr data-target="${pk}">
                                        <th>${pk}</th>
                                        <th>${fields.create_time}</th>
                                        <th>${fields.addr_xiaoqu}</th>
                                        <th>${fields.type_room}室${fields.type_livingroom}厅${fields.type_toilet}卫</th>
                                        <th>${fields.price}万元</th>
                                        <th>${fields.contactPerson}</th>
                                        <th>${fields.contactPerson}</th>
                                        <th>{{if fields.have_image}}有{{else}}无{{/if}}</th>
                                        <th>
                                            {{if fields.sold }}
                                                已下架
                                            {{else fields.exist}}
                                                已上架
                                            {{else}}
                                                待编辑
                                            {{/if}}
                                        </th>
                                        <th class="btn-group">
                                            <button class="btn btn-default dropdown-toggle" data-toggle="dropdown">操作<span class="caret"></span></button>
                                            <ul class="dropdown-menu">
                                                {{if fields.sold }}

                                                {{else fields.exist}}
                                                    <li><a href="#" class="btn-operate" data-type="salesold">下架</a></li>
                                                    <li><a href="/new_salehouse/?roomNumber=${pk}">编辑</a></li>
                                                {{else}}
                                                    <li><a href="/new_salehouse/?roomNumber=${pk}">编辑</a></li>
                                                {{/if}}
                                            </ul>
                                        </th>
                                    </tr>

</script>

<script id="community-list-option" type="text/x-jquery-tmpl">
    <option value="${pk}">${pk}</option>
</script>


<script id="comment-tmpl" type="text/x-jquery-tmpl">
    <tr class="comment-item" data-target="${pk}">
                            <th><a href="/room_detail/?roomNubmer=${fields.roomNumber}" target="_blank">${fields.roomNumber}</a></th>
                            <th style="width:50%;">${fields.text}</th>
                            <th>{{if fields.ifpass == null}} 未审核 {{else}} {{if fields.ifpass == false}} 未通过 {{else}}已通过{{/if}}{{/if}}</th>
                            <th>
                                <button class="btn btn-danger btn-operate" data-type="delete">删除</button>
                                <button class="btn btn-warning btn-operate" data-type="cancel">驳回</button>
                                <button class="btn btn-success btn-operate" data-type="activate">通过</button>
                            </th>
                        </tr>
</script>

<script id="areaname-search" type="text/x-jquery-tmpl">
    <tr data-target="${pk}">
        <th>${pk}</th>
        <th>
            <button class="btn btn-danger btn-operate" data-type="cancel">删除</button>
        </th>
    </tr>
</script>

{% endverbatim %}

<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=gbADGzE7DryWx922MKlLKEnj"></script>
<script src="/js/jquery.tmpl.min.js"></script>
<script src="/js/jquery.pagenation.js"></script>
<script type="text/javascript">
    // 百度地图API功能

    //    地图创建
    var map = new BMap.Map("xiaoqu-map");    // 创建Map实例
    map.centerAndZoom("杭州",15);

    //    添加控件
    var top_left_control = new BMap.ScaleControl({anchor: BMAP_ANCHOR_TOP_LEFT});// 左上角，添加比例尺
    var top_left_navigation = new BMap.NavigationControl();  //左上角，添加默认缩放平移控件
    map.addControl(top_left_control);
    map.addControl(top_left_navigation);

    var marker = new BMap.Marker(new BMap.Point(120.169848,30.276734));  // 创建标注
    map.addOverlay(marker);              // 将标注添加到地图中
    marker.enableDragging();

    //    编辑地图创建
    var edit_map = new BMap.Map("edit-xiaoqu-map");    // 创建Map实例
    edit_map.centerAndZoom("杭州",15);

    //    添加控件
    var edit_top_left_control = new BMap.ScaleControl({anchor: BMAP_ANCHOR_TOP_LEFT});// 左上角，添加比例尺
    var edit_top_left_navigation = new BMap.NavigationControl();  //左上角，添加默认缩放平移控件
    edit_map.addControl(edit_top_left_control);
    edit_map.addControl(edit_top_left_navigation);

    var edit_marker = new BMap.Marker(new BMap.Point(120.169848,30.276734));  // 创建标注
    edit_map.addOverlay(edit_marker);              // 将标注添加到地图中
    edit_marker.enableDragging();

</script>

<script>
    ;(function(){

        var m_list=JSON.parse({{ managers_js|safe }});
        var _managers=[];

        for(var i=0;i<m_list.length;i++){
            _managers.push({pk:m_list[i].pk,status:m_list[i].fields.status});
        }

        var editUrlMap={
            "#xiaoqu-edit":"{% url 'get_community'%}",
            "#area-edit":"{% url 'get_manager'%}",
            "#mansion-keeper-edit":"{% url 'get_second_manager'%}",
            "#mansion-manager-edit":"{% url 'get_manager'%}",
            "#wuye-keeper-edit":"{% url 'get_second_manager'%}"
        };

        var cancelUrlMap={
            "#xiaoqu-edit":"{% url 'community_delete'%}",
            "#area-edit":"{% url 'manager_logout'%}",
            "#mansion-keeper-edit":"{% url 'second_manager_logout'%}",
            "#mansion-manager-edit":"{% url 'manager_logout'%}",
            "#wuye-keeper-edit":"{% url 'second_manager_logout'%}",
            "comment":"{% url 'evaluation_no_pass' %}",
            "house":"{% url 'roominfo_logout' %}",
            "salehouse":"/salehouse_logout",
            "areaname":"{% url 'post_delete_area' %}"
        };


        var activateUrlMap={
            "#area-edit":"{% url 'manager_active'%}",
            "#mansion-keeper-edit":"{% url 'second_manager_active'%}",
            "#mansion-manager-edit":"{% url 'manager_active'%}",
            "#wuye-keeper-edit":"{% url 'second_manager_active'%}",
            "comment":"{% url 'evaluation_pass' %}",
            "house":"{% url 'roominfo_active' %}",
            "salehouse":"/salehouse_active"
        };


        //保存地图上选中的点
        $("#save-point").bind("click",function(e){
            e.preventDefault();
            var p = marker.getPosition();
            $("#xiaoqu_add_lng").val(p.lng);
            $("#xiaoqu_add_lat").val(p.lat);
        });


        $("#edit-save-point").bind("click",function(e){
            e.preventDefault();
            e.stopPropagation();
            var p = edit_marker.getPosition();
            $("#edit_xiaoqu_add_lng").val(p.lng);
            $("#edit_xiaoqu_add_lat").val(p.lat);
        });


        //为查询form添加ajax
        $(document).delegate(".btn-get","click",function(e){
            e.preventDefault();
            var form = $(this).parents("form");
            var type=$(this).data("type");
            var _tmpl="#"+type+"-search";
            var _wrapper="#"+type+"-search-result";
            var dest = form.attr("dest");
            var content=form.serialize();


            if(type==="salehouse" || type==='house'){
                //如果是房源搜索的话，先存储搜索结果
                var dataArr = form.serializeArray();
                $("#cache_"+type+"_status").val(dataArr[0].value);
                $("#cache_"+type+"_area").val(dataArr[1].value);
            }

            $.get(
                dest,
                content,
                function(data){
                    if(data.code==1){
                        console.log("get success");
//                        $("#house-item").tmpl(rawData).appendTo('#search-result-container');
                        $(_wrapper).empty();
                        $(_tmpl).tmpl(JSON.parse(data.context)).appendTo(_wrapper);
                        if(type==="salehouse" || type==='house'){
                            //先清空分页
                            $("#Pagination-"+type).remove();
                            //如果是房源搜索的话，就还要加上分页
                            var _pagenation='<div id="Pagination-'+type+'" class="pagination"></div>';
                            $("#"+type+"-table").after(_pagenation);

                            var _cb=type==="house"?pageHouseCB:pageSalehouseCB;

                            $("#Pagination-"+type).pagination(data.count, {
                                num_edge_entries: 1, //边缘页数
                                num_display_entries: 1, //主体页数
                                callback: _cb,
                                items_per_page:1 //每页显示1项
                            });
                        }
                    }else{
                        console.log("get failed");
                    }
                }
            )
            .error(function(){
                console.log("error");
            })
        });

        //为新增form添加ajax
        $(document).delegate(".btn-post","click",function(e){
            e.preventDefault();

            var _input=$(this).parents("form").find("input[type=password]");

            _input.next().val($.md5(_input.val()));
            var form = $(this).parents("form");
            var dest = form.attr("dest");

            var p1 = marker.getPosition();
            $("#xiaoqu_add_lng").val(p1.lng);
            $("#xiaoqu_add_lat").val(p1.lat);

            var p2 = edit_marker.getPosition();
            $("#edit_xiaoqu_add_lng").val(p2.lng);
            $("#edit_xiaoqu_add_lat").val(p2.lat);

            var content=form.serialize();
            $.post(
                    dest,
                    content,
                    function(data){
                        if(data.code==1){
                            alert("保存成功！");
                        }else{
                            if(!!data.msg){
                                alert(data.msg);
                            }else{
                                alert("保存失败！");
                            }
                        }
                    }
            )
            .error(function(){
                console.log("error");
            });
        });

        //查询结果按钮相应 编辑弹框，别的只是发对应的请求

        //添加日期输入启动datetimepicker
        $('#source_manager_search_time').datepicker({  dateFormat: "yy-mm-dd" });

        var dialogOpts = {
            title:"编辑信息",
            width:"800",
            height:"500"
        };

        //编辑按钮，获取对应信息并添加到dialog
        $(document).delegate(".btn-edit","click",function(e){
            e.preventDefault();
            var _id=$(this).parents("tr").data("target");//该条目id
            var _tmplID=$(this).parents("table").data("tmpl");
            var _url=editUrlMap[_tmplID];

            $.get(
                _url,//TODO:修改url
                {id:_id},
                function(data){
                    if(data.code==1){
                        console.log("get success");
                        //添加dialog
                        if(_tmplID=="#xiaoqu-edit"){
                            $("#xiaoqu-edit-wrapper").empty();

                            edit_map.centerAndZoom(new BMap.Point(data.context.lng-0.02,data.context.lat+0.01),15);
                            edit_marker = new BMap.Marker(new BMap.Point(data.context.lng,data.context.lat));  // 创建标注
                            edit_map.clearOverlays();
                            edit_map.addOverlay(edit_marker);              // 将标注添加到地图中
                            edit_marker.enableDragging();

                            $(_tmplID).tmpl(data.context).appendTo("#xiaoqu-edit-wrapper");
                            $("#xiaoqu-edit-dialog").dialog(dialogOpts);
                        }else{
                            if(_tmplID=="#mansion-keeper-edit"||_tmplID=="#wuye-keeper-edit"){
                                $(_tmplID).tmpl($.extend(data.context,{m_list:_managers})).dialog(dialogOpts);
                            }else{
                                $(_tmplID).tmpl(data.context).dialog(dialogOpts);
                            }
                        }
                    }else{
                        console.log("get failed");
                    }
                }
            )
            .error(function(){
                console.log("error");
            });
        });

        //下架/注销等按钮
        $(document).delegate(".btn-operate","click",function(e){
            e.preventDefault();
            var _id=$(this).parents("tr").data("target");//该条目id
            var _tmplID=$(this).parents("table").data("tmpl");
            var _type=$(this).data("type")
            var _url=_type==="activate"?activateUrlMap[_tmplID]:(_type==="cancel"?cancelUrlMap[_tmplID]:"{% url 'evaluation_delete' %}");


            if(_type==="sold"||_type==="salesold"){
                _url=_type==="sold"?"{% url 'roominfo_sold' %}":"{% url 'salehouse_sold' %}";
                $.post(
                    _url,
                    {roomNumber:_id},
                    function(data){
                        if(data.code==1){
                            console.log("post success");
                            //TODO: 修改对应的表格状态
                            alert("操作成功！");
                        }else{
                            console.log("post failed");
                            alert("操作失败！");

                        }
                    }
            )
                    .error(function(){
                        console.log("error");
                    });

            }else{
                $.post(
                    _url,
                    {id:_id},
                    function(data){
                        if(data.code==1){
                            console.log("post success");
                            //TODO: 修改对应的表格状态
                            alert("操作成功！");
                        }else{
                            console.log("post failed");
                            alert("操作失败！");
                        }
                    }
                )
                        .error(function(){
                            console.log("error");
                        });
                }

        });

        $(document).delegate(".select-listener","change",function(e){
//            console.log($(this).val());
            var value=$(this).val();
            var wrapper=$(this).attr("id").indexOf("edit_")==-1?"#wuye_keeper_add_xiaoqu":"#edit_wuye_keeper_add_xiaoqu";

            $.get(
                    "{% url 'get_community_list_by_manager' %}",
                    {id:value},
                    function(data){
                        if(data.code==1){
                            console.log("post success");
                            $(wrapper).empty();
                            $("#community-list-option").tmpl(JSON.parse(data.context)).appendTo(wrapper);
                        }else{
                            console.log("post failed");
                        }
                    }
            )
            .error(function(){
                console.log("error");
            });
        });


        //这是一个非常简单的demo实例，让列表元素分页显示
        //回调函数的作用是显示对应分页的列表项内容
        //回调函数在用户每次点击分页链接的时候执行
        //参数page_index{int整型}表示当前的索引页
        var initPagination = function() {
            var num_entries = {{ evaluation_count }};
            // 创建分页
            $("#Pagination").pagination(num_entries, {
                num_edge_entries: 1, //边缘页数
                num_display_entries: 1, //主体页数
                callback: pageselectCallback,
                items_per_page:10 //每页显示1项
            });
        }();

        function pageselectCallback(page_index, jq){
            $("#comment-result").empty();
            var _p=page_index+1;


            $.get(
                    "{% url 'evaluation_search' %}",
                    {p:_p},
                    function(data){
                        if(data.code==1){
                            $("#comment-tmpl").tmpl(JSON.parse(data.context)).appendTo($("#comment-result"));
                        }else{
                            console.log("get failed");
                        }
                    }
            )
            .error(function(){
                console.log("error");
            });
            return false;
        }


        function pageHouseCB(page_index, jq){
            $("#house-search-result").empty();
            var _p=page_index+1;
            var _status=$("#cache_house_status").val();
            var _area=$("#cache_house_area").val();

            $.get(
                    "{% url 'room_search' %}",
                    {p:_p,
                     house_status:_status,
                    house_area:_area},
                    function(data){
                        if(data.code==1){
                            $("#house-search").tmpl(JSON.parse(data.context)).appendTo($("#house-search-result"));
                        }else{
                            console.log("get failed");
                        }
                    }
            )
            .error(function(){
                console.log("error");
            });
            return false;
        }


        function pageSalehouseCB(page_index, jq){
            $("#salehouse-search-result").empty();
            var _p=page_index+1;
            var _status=$("#cache_salehouse_status").val();
            var _area=$("#cache_salehouse_area").val();

            $.get(
                    "/salehouse_search/",
                    {p:_p,
                     house_status:_status,
                    house_area:_area},
                    function(data){
                        if(data.code==1){
                            $("#salehouse-search").tmpl(JSON.parse(data.context)).appendTo($("#salehouse-search-result"));
                        }else{
                            console.log("get failed");
                        }
                    }
            )
            .error(function(){
                console.log("error");
            });
            return false;
        }




        
    })();

</script>

{% endblock %}
