<!--extentds-->
{% extends './common/base.html' %}

<!--title-->
{% block title %}详情页{% endblock %}

<!--sp_header-->
{% block sp_header %}
    <link rel="stylesheet" href="/stylesheet/detail.css">
{% endblock %}


<!--content-->
{% block content %}
<div id="index-banner" class="parallax-container">
    <div class="section no-pad-bot">
      <div class="container">
        <br><br>
        <h1 class="header center teal-text text-lighten-2"> {{room.addr_xiaoqu}}</h1>
        <div class="row center">
          <h5 class="header col s12 light"><span class="bigger">{{room.type_room}}</span>室<span class="bigger">{{room.type_livingroom}}</span>厅<span class="bigger">{{room.type_toilet}}</span>卫&nbsp;<span class="bigger">{{ room.price }}</span>万元&nbsp;{{ room.roomNumber }}</h5>
        </div>
        <div class="row center">
          <a href="#" id="download-button" data-target="yuyueanniu" class="btn-yuyue btn-large waves-effect waves-light teal lighten-1"><i class="large material-icons left">grade</i>收藏</a>
          <a href="#" id="download-button" class="btn-large waves-effect waves-light teal lighten-1"><i class="large material-icons left">contact_phone</i>预约</a>
        </div>
        <br><br>

      </div>
    </div>
    <div class="parallax">
        <img src="/resource/background1.jpg" alt="Unsplashed background img 2">
    </div>

</div>


  <div class="container">
    <div class="section">

      <!--   Icon Section   -->
      <div class="row">
        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center brown-text"><i class="mdi-image-flash-on"></i></h2>
            <h5 class="center">基本情况</h5>
            <div class="light">
                <div class="room-detail-content">
                    <div class="detail-item"><span class="detail-item-key">户型</span><span class="detail-item-value">{{ room.type_room}}室{{room.type_livingroom}}厅{{room.type_toilet}}卫</span></div>
                    <div class="detail-item"><span class="detail-item-key">租金</span><span class="detail-item-value">{{ room.price }}万元</span></div>
                    <div class="detail-item"><span class="detail-item-key">面积</span><span class="detail-item-value">{{ room.mianji }}m2</span></div>
                    <div class="detail-item"><span class="detail-item-key">朝向</span><span class="detail-item-value">朝{{ room.orientation }}</span></div>
                    <div class="detail-item"><span class="detail-item-key">楼层</span><span class="detail-item-value">{{ room.floor_level}}层/共{{room.total_floor}}层</span></div>
                    <div class="detail-item"><span class="detail-item-key">类型</span><span class="detail-item-value">{{ room.type }}</span></div>
                </div>
            </div>
          </div>
        </div>

        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center brown-text"><i class="mdi-social-group"></i></h2>
            <h5 class="center">房屋配置</h5>

            <div class="light">
                <div class="room-detail-content">
                    <div class="detail-item"><span class="detail-item-key">产证满二</span><span class="detail-item-value">{% if room.maner == "yes" %}是{% else %}否{% endif %}</span></div>
                    <div class="detail-item"><span class="detail-item-key">唯一住房</span><span class="detail-item-value">{% if room.weiyi == "yes" %}是{% else %}否{% endif %}</span></div>
                    <div class="detail-item">
                        <span class="detail-item-key">屋内配置</span>
                        <span class="detail-item-value">
                            {% if room.canzhuo == "on" %}餐桌&nbsp{% endif %}
                            {% if room.sofa == "on" %}沙发&nbsp{% endif %}
                            {% if room.desk == "on" %}书桌&nbsp{% endif %}
                            {% if room.chair == "on" %}椅子&nbsp{% endif %}
                            {% if room.closet == "on" %}衣柜&nbsp{% endif %}
                            {% if room.bed == "on" %}床&nbsp{% endif %}
                            {% if room.aircon == "on" %}空调&nbsp{% endif %}
                            {% if room.washer == "on" %}洗衣机&nbsp{% endif %}
                            {% if room.waterheater == "on" %}热水器&nbsp{% endif %}
                            {% if room.refregister == "on" %}冰箱&nbsp{% endif %}
                            {% if room.tv == "on" %}电视机&nbsp{% endif %}
                            {% if room.cookerhood == "on" %}油烟机&nbsp{% endif %}
                            {% if room.gascooker == "on" %}燃气灶&nbsp{% endif %}
                        </span>
                    </div>
                </div>



            </div>
          </div>
        </div>

          <div class="col s12 m4">
              <div class="icon-block">
                <h2 class="center brown-text"><i class="mdi-image-flash-on"></i></h2>
                <h5 class="center">房源描述</h5>

                <div class="light">
                    <div class="room-detail-content">
                        <div class="detail-item"><span class="detail-item-key">房源描述</span><span class="detail-item-value">{{room.house_desc}}</span></div>
                    </div>

                    <div class="room-master">
                        <div class="room-master-img">

                        </div>

                        <div class="room-master-desc">
                            <div class="room-master-name">
                                联系人：</br>
                                {{contactPerson.name}}
                            </div>
                        </div>
                    </div>

                </div>
              </div>
            </div>
          </div>

    </div>
  </div>


  <div class="parallax-container valign-wrapper">
    <div class="section no-pad-bot">
      <div class="container">
        <div class="row center">
{#          <h5 class="header col s12 light">A modern responsive front-end framework based on Material Design</h5>#}
        </div>
      </div>
    </div>
    <div class="parallax">
        <img src="/resource/background3.jpg" alt="Unsplashed background img 2">

{#        <div class="J_Poster poster-main" data-setting='{#}
{#                                                                                    "width":800,#}
{#                                                                                    "height":270,#}
{#                                                                                    "posterWidth":640,#}
{#                                                                                    "posterHeight":270,#}
{#                                                                                    "scale":0.8,#}
{#                                                                                    "autoPlay":true,#}
{#                                                                                    "delay":5000,#}
{#                                                                                    "speed":300,#}
{#                                                                                    "vericalAlign":"top"#}
{#																					}'>#}
{#            <div class="poster-btn poster-prev-btn"></div>#}
{#            <ul class="poster-list">#}
{#                <li class="poster-item"><a href="#"><img class="materialboxed" src="/resource/c1.jpg" width="100%" height="100%"></a></li>#}
{#                <li class="poster-item"><a href="#"><img class="materialboxed" src="/resource/c2.jpg" width="100%" height="100%"></a></li>#}
{#                <li class="poster-item"><a href="#"><img class="materialboxed" src="/resource/c3.jpg" width="100%" height="100%"></a></li>#}
{#                <li class="poster-item"><a href="#"><img class="materialboxed" src="/resource/c4.jpg" width="100%" height="100%"></a></li>#}
{#            </ul>#}
{#            <div class="poster-btn poster-next-btn"></div>#}
{#        </div>#}
    </div>
  </div>



    <div class="container">
    <div class="section">

      <div class="row">
        <div class="col s12 center">
            <div class="room-detail-section room-detail-section-fulllength">
                <div class="room-detail-content peitao">
                    <a class="facility-item waves-effect waves-light btn" data-type="公交">公交</a>
                    <a class="facility-item waves-effect waves-light btn" data-type="地铁">地铁</a>
                    <a class="facility-item waves-effect waves-light btn" data-type="银行">银行</a>
                    <a class="facility-item waves-effect waves-light btn" data-type="医院">医院</a>
                    <a class="facility-item waves-effect waves-light btn" data-type="超市">超市</a>
                    <a class="facility-item waves-effect waves-light btn" data-type="餐馆">餐馆</a>
{#                    <div class="room-detail-facility">#}
{#                        <div class="facility-title">#}
{#                            周边设施#}
{#                        </div>#}
{##}
{##}
{##}
{##}
{#                        <div class="facility-choose">#}
{##}
{#                            <ul style="width:80px;">#}
{#                                <li class="active facility-item" data-type="公交"><span class="facility-icon"></span>公交</span></li>#}
{#                                <li class="facility-item" data-type="地铁"><span class="facility-icon"></span><span class="facility-name"><span class="glyphicon glyphicon-home" aria-hidden="true"></span><br/>地铁</span></li>#}
{#                                <li class="facility-item" data-type="银行"><span class="facility-icon"></span><span class="facility-name"><span class="glyphicon glyphicon-home" aria-hidden="true"></span><br/>银行</span></li>#}
{#                                <li class="facility-item" data-type="医院"><span class="facility-icon"></span><span class="facility-name"><span class="glyphicon glyphicon-home" aria-hidden="true"></span><br/>医院</span></li>#}
{#                                <li class="facility-item" data-type="超市"><span class="facility-icon"></span><span class="facility-name"><span class="glyphicon glyphicon-home" aria-hidden="true"></span><br/>超市</span></li>#}
{#                                <li class="facility-item" data-type="餐馆"><span class="facility-icon"></span><span class="facility-name"><span class="glyphicon glyphicon-home" aria-hidden="true"></span><br/>美食</span></li>#}
{#                            </ul>#}
{#                        </div>#}
{#                    </div>#}
                    <div id="room-detail-map">

                    </div>
                </div>
            </div>

            <div class="room-detail-section room-detail-section-fulllength">
                <div class="room-detail-title"><span class="glyphicon glyphicon-home" aria-hidden="true"></span>租客评价</div>
                <div class="room-detail-content">
                    {% for i in evaluation %}
                        <div class="row" style="position: relative;">
                            <div class="comment-avatar" style="background: url(http://img.huoju365.com/file/5245a2fa-62f4-4ed1-af96-20cc167e56a8);-moz-background-size:100% 100%;background-size:100% 100%;"></div>
                            <div class="comment-content">
                                <span class="comment-quote">“</span>
                                {{ i.text }}
                            </div>
                        </div>
                    {% endfor %}

                    <div class="row" style="position: relative;margin-top:50px;margin-bottom:150px;">
                        <div class="comment-avatar" style="background: url(http://img.huoju365.com/file/5245a2fa-62f4-4ed1-af96-20cc167e56a8);-moz-background-size:100% 100%;background-size:100% 100%;"></div>
                        <div class="comment-content" style="border:none;padding:0;background: #f5f5f5;">
                            <form class="col s12">
                              <div class="row">
                                <div class="input-field col s12">
                                  <textarea id="textarea1" class="materialize-textarea"></textarea>
                                  <label for="textarea1">留下我的评论</label>
                                </div>
                              </div>
                            </form>
                            <button id="comment-submit" class="btn" style="position: absolute;bottom:-10px;left:10px;"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span>&nbsp;提交我的评论</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
      </div>

    </div>
  </div>


{% endblock %}

<!--sp_script-->
{% block sp_script %}

<script src="/js/jquery.pin.min.js" type="text/javascript"></script>
{#<script src="/js/carousel.js" type="text/javascript"></script>#}
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=gbADGzE7DryWx922MKlLKEnj"></script>
<script type="text/javascript">
    // 百度地图API功能

    //    地图创建
    var map = new BMap.Map("room-detail-map");    // 创建Map实例
    var mPoint = new BMap.Point({{ lng|safe }}, {{ lat|safe }});
//    map.enableScrollWheelZoom(false);
    map.centerAndZoom(mPoint,15);

    var circle = new BMap.Circle(mPoint,1000,{fillColor:"blue", strokeWeight: 1 ,fillOpacity: 0.2, strokeOpacity: 0.3});
    map.addOverlay(circle);
    var local =  new BMap.LocalSearch(map, {renderOptions: {map: map, autoViewport: false}});
    local.searchNearby('公交',mPoint,1000);

    //    添加控件
    var top_left_control = new BMap.ScaleControl({anchor: BMAP_ANCHOR_TOP_LEFT});// 左上角，添加比例尺
    var top_left_navigation = new BMap.NavigationControl();  //左上角，添加默认缩放平移控件
    map.addControl(top_left_control);
    map.addControl(top_left_navigation);

</script>

<script>
    $(function(){

        $('.button-collapse').sideNav();
        $('.parallax').parallax();


        //pin住右侧的房源情况
        $(".room-info").pin({
            containerSelector: "#pin-container"
        });

        //周边设施交互
        $(".facility-item ").bind("click",function(e){
{#            $(".facility-item.active").removeClass("active");#}
{#            $(this).addClass("active");#}

            var searchItem=$(this).data("type");
            local.searchNearby(searchItem,mPoint,1000);
        });

        $("#comment-submit").bind("click",function(e){
            var _text=$("#comment").val();
            var _num=$("#room-number").text();
            $.post(
                    {% url 'evaluation_add' %},
                    {
                        text:_text,
                        roomNumber:_num
                    },
                    function(data){
                        if(data.code==1){
                            console.log("post success");
                            alert("评论发布成功，正在等待管理员审核！");
                        }else{
                            console.log("post failed");
                            alert("评论发布失败！");
                        }
                    }
            )
            .error(function(){
                console.log("error");
            });
        });

        $(document).delegate(".btn-yuyue","click",function(e){
            e.preventDefault();
            var _id=$(this).data("target");
            var that=$(this);

            $.post(
                "{% url 'room_collection' %}",
                {roomNumber:_id},
                function(data){
                    if(data.status==200){
                        that.addClass("active");
                        console.log("post success");
                        alert("已加入收藏夹");
                    }else{
                        console.log("post failed");
                        if(msg){
                            alert(msg);
                        }
                    }
                }
            )
            .error(function(){
                console.log("error");
            });
        });
    });
</script>

{% endblock %}